<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/components/MeasurementItem.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/components/MeasurementItem.kt" />
              <option name="originalContent" value="package com.example.healynk.ui.components&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.healynk.models.Measurement&#10;import com.example.healynk.utils.Formatters&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Delete&#10;&#10;@Composable&#10;fun MeasurementItem(&#10;    measurement: Measurement,&#10;    onDelete: (() -&gt; Unit)? = null,&#10;    modifier: Modifier = Modifier,&#10;    deleteIcon: ImageVector = Icons.Default.Delete&#10;) {&#10;    Card(&#10;        modifier = modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surfaceVariant),&#10;        elevation = CardDefaults.cardElevation(0.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                Text(text = Formatters.formatDateTime(measurement.timestamp), style = MaterialTheme.typography.labelLarge)&#10;                if (onDelete != null) {&#10;                    IconButton(onClick = onDelete) {&#10;                        Icon(imageVector = deleteIcon, contentDescription = &quot;Delete measurement&quot;)&#10;                    }&#10;                }&#10;            }&#10;            measurement.weightKg?.let {&#10;                Text(text = &quot;Berat: $it kg&quot;, fontWeight = FontWeight.SemiBold)&#10;            }&#10;            measurement.heightCm?.let {&#10;                Text(text = &quot;Tinggi: $it cm&quot;)&#10;            }&#10;            if (measurement.systolic != null &amp;&amp; measurement.diastolic != null) {&#10;                Text(text = &quot;Tekanan darah: ${measurement.systolic}/${measurement.diastolic} mmHg&quot;)&#10;            }&#10;            measurement.glucoseMgDl?.let {&#10;                Text(text = &quot;Gula darah: $it mg/dL&quot;)&#10;            }&#10;            measurement.notes?.takeIf { it.isNotBlank() }?.let {&#10;                Text(text = it, style = MaterialTheme.typography.bodyMedium)&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.healynk.ui.components&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.healynk.models.Measurement&#10;import com.example.healynk.utils.Formatters&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Delete&#10;&#10;@Composable&#10;fun MeasurementItem(&#10;    measurement: Measurement,&#10;    onDelete: (() -&gt; Unit)? = null,&#10;    modifier: Modifier = Modifier,&#10;    deleteIcon: ImageVector = Icons.Default.Delete&#10;) {&#10;    Card(&#10;        modifier = modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surfaceVariant),&#10;        elevation = CardDefaults.cardElevation(0.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                Text(text = Formatters.formatDateTime(measurement.timestamp), style = MaterialTheme.typography.labelLarge)&#10;                if (onDelete != null) {&#10;                    IconButton(onClick = onDelete) {&#10;                        Icon(imageVector = deleteIcon, contentDescription = &quot;Delete measurement&quot;)&#10;                    }&#10;                }&#10;            }&#10;            measurement.weightKg?.let {&#10;                Text(text = &quot;Berat: $it kg&quot;, fontWeight = FontWeight.SemiBold)&#10;            }&#10;            measurement.heightCm?.let {&#10;                Text(text = &quot;Tinggi: $it cm&quot;)&#10;            }&#10;            if (measurement.systolic != null &amp;&amp; measurement.diastolic != null) {&#10;                Text(text = &quot;Tekanan darah: ${measurement.systolic}/${measurement.diastolic} mmHg&quot;)&#10;            }&#10;            measurement.glucoseMgDl?.let {&#10;                Text(text = &quot;Gula darah: $it mg/dL&quot;)&#10;            }&#10;            measurement.notes?.takeIf { it.isNotBlank() }?.let {&#10;                Text(text = it, style = MaterialTheme.typography.bodyMedium)&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/AnalyticsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/AnalyticsScreen.kt" />
              <option name="originalContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.weight as weightModifier&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.Divider&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.healynk.viewmodel.UiState&#10;&#10;@Composable&#10;fun AnalyticsScreen(uiState: UiState) {&#10;    val latest = uiState.latestMeasurement&#10;    val avgBp = uiState.bloodPressureTrend.mapNotNull { it.second.first to it.second.second }&#10;    val avgSystolic = avgBp.mapNotNull { it.first }.averageOrNull()&#10;    val avgDiastolic = avgBp.mapNotNull { it.second }.averageOrNull()&#10;    val avgGlucose = uiState.glucoseTrend.mapNotNull { it.second }.averageOrNull()&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&quot;Analytics&quot;, style = MaterialTheme.typography.headlineSmall)&#10;        Row(horizontalArrangement = Arrangement.spacedBy(12.dp), modifier = Modifier.fillMaxWidth()) {&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Kalori masuk&quot;,&#10;                value = &quot;${uiState.dailyCalories} kcal&quot;,&#10;                subtitle = &quot;Target ${uiState.dailyCaloriesGoal}&quot;&#10;            )&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Aktivitas&quot;,&#10;                value = &quot;${uiState.dailyActivityCalories} kcal&quot;,&#10;                subtitle = &quot;${uiState.summaryDuration} mnt&quot;&#10;            )&#10;        }&#10;        Row(horizontalArrangement = Arrangement.spacedBy(12.dp), modifier = Modifier.fillMaxWidth()) {&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Tekanan darah rata2&quot;,&#10;                value = avgSystolic?.let { s -&gt;&#10;                    val d = avgDiastolic ?: 0.0&#10;                    &quot;${s.toInt()}/${d.toInt()}&quot;&#10;                } ?: &quot;-&quot;,&#10;                subtitle = &quot;Data 7 hari&quot;&#10;            )&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Gula rata2&quot;,&#10;                value = avgGlucose?.toInt()?.toString() ?: &quot;-&quot;,&#10;                subtitle = &quot;mg/dL&quot;&#10;            )&#10;        }&#10;        latest?.let {&#10;            Card(colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surface)) {&#10;                Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                    Text(&quot;Pengukuran terakhir&quot;, style = MaterialTheme.typography.titleMedium)&#10;                    Text(&quot;Berat: ${it.weightKg ?: &quot;-&quot;} kg&quot;)&#10;                    Text(&quot;Tekanan: ${it.systolic ?: &quot;-&quot;}/${it.diastolic ?: &quot;-&quot;} mmHg&quot;)&#10;                    Text(&quot;Gula: ${it.glucoseMgDl ?: &quot;-&quot;} mg/dL&quot;)&#10;                }&#10;            }&#10;        }&#10;        TrendList(title = &quot;Kalori makanan 7 hari&quot;, entries = uiState.weeklyFoodChart)&#10;        TrendList(title = &quot;Kalori aktivitas 7 hari&quot;, entries = uiState.weeklyActivityChart)&#10;        TrendList(title = &quot;Tren berat&quot;, entries = uiState.weightTrend.map { it.first to it.second.toInt() })&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun RowScope.AnalyticsSummaryCard(title: String, value: String, subtitle: String) {&#10;    Card(&#10;        modifier = Modifier.weight(1f),&#10;        colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surfaceVariant)&#10;    ) {&#10;        Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;            Text(text = title, style = MaterialTheme.typography.labelLarge)&#10;            Text(text = value, style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold))&#10;            Text(text = subtitle, style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.onSurfaceVariant)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun TrendList(title: String, entries: List&lt;Pair&lt;String, Int&gt;&gt;) {&#10;    if (entries.isEmpty()) return&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Text(text = title, style = MaterialTheme.typography.titleMedium)&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        Card {&#10;            LazyColumn {&#10;                items(entries) { (day, value) -&gt;&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 16.dp, vertical = 12.dp),&#10;                        horizontalArrangement = Arrangement.SpaceBetween&#10;                    ) {&#10;                        Text(day)&#10;                        Text(&quot;$value&quot;)&#10;                    }&#10;                    Divider()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;private fun List&lt;Int?&gt;.averageOrNull(): Double? {&#10;    val filtered = this.filterNotNull()&#10;    return if (filtered.isNotEmpty()) filtered.average() else null&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.weight as weightModifier&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.Divider&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.healynk.viewmodel.UiState&#10;&#10;@Composable&#10;fun AnalyticsScreen(uiState: UiState) {&#10;    val latest = uiState.latestMeasurement&#10;    val avgBp = uiState.bloodPressureTrend.mapNotNull { it.second.first to it.second.second }&#10;    val avgSystolic = avgBp.mapNotNull { it.first }.averageOrNull()&#10;    val avgDiastolic = avgBp.mapNotNull { it.second }.averageOrNull()&#10;    val avgGlucose = uiState.glucoseTrend.mapNotNull { it.second }.averageOrNull()&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&quot;Analytics&quot;, style = MaterialTheme.typography.headlineSmall)&#10;        Row(horizontalArrangement = Arrangement.spacedBy(12.dp), modifier = Modifier.fillMaxWidth()) {&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Kalori masuk&quot;,&#10;                value = &quot;${uiState.dailyCalories} kcal&quot;,&#10;                subtitle = &quot;Target ${uiState.dailyCaloriesGoal}&quot;&#10;            )&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Aktivitas&quot;,&#10;                value = &quot;${uiState.dailyActivityCalories} kcal&quot;,&#10;                subtitle = &quot;${uiState.summaryDuration} mnt&quot;&#10;            )&#10;        }&#10;        Row(horizontalArrangement = Arrangement.spacedBy(12.dp), modifier = Modifier.fillMaxWidth()) {&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Tekanan darah rata2&quot;,&#10;                value = avgSystolic?.let { s -&gt;&#10;                    val d = avgDiastolic ?: 0.0&#10;                    &quot;${s.toInt()}/${d.toInt()}&quot;&#10;                } ?: &quot;-&quot;,&#10;                subtitle = &quot;Data 7 hari&quot;&#10;            )&#10;            AnalyticsSummaryCard(&#10;                title = &quot;Gula rata2&quot;,&#10;                value = avgGlucose?.toInt()?.toString() ?: &quot;-&quot;,&#10;                subtitle = &quot;mg/dL&quot;&#10;            )&#10;        }&#10;        latest?.let {&#10;            Card(colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surface)) {&#10;                Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                    Text(&quot;Pengukuran terakhir&quot;, style = MaterialTheme.typography.titleMedium)&#10;                    Text(&quot;Berat: ${it.weightKg ?: &quot;-&quot;} kg&quot;)&#10;                    Text(&quot;Tekanan: ${it.systolic ?: &quot;-&quot;}/${it.diastolic ?: &quot;-&quot;} mmHg&quot;)&#10;                    Text(&quot;Gula: ${it.glucoseMgDl ?: &quot;-&quot;} mg/dL&quot;)&#10;                }&#10;            }&#10;        }&#10;        TrendList(title = &quot;Kalori makanan 7 hari&quot;, entries = uiState.weeklyFoodChart)&#10;        TrendList(title = &quot;Kalori aktivitas 7 hari&quot;, entries = uiState.weeklyActivityChart)&#10;        TrendList(title = &quot;Tren berat&quot;, entries = uiState.weightTrend.map { it.first to it.second.toInt() })&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun RowScope.AnalyticsSummaryCard(title: String, value: String, subtitle: String) {&#10;    Card(&#10;        modifier = Modifier.weight(1f),&#10;        colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surfaceVariant)&#10;    ) {&#10;        Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;            Text(text = title, style = MaterialTheme.typography.labelLarge)&#10;            Text(text = value, style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold))&#10;            Text(text = subtitle, style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.onSurfaceVariant)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun TrendList(title: String, entries: List&lt;Pair&lt;String, Int&gt;&gt;) {&#10;    if (entries.isEmpty()) return&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Text(text = title, style = MaterialTheme.typography.titleMedium)&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        Card {&#10;            LazyColumn {&#10;                items(entries) { (day, value) -&gt;&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 16.dp, vertical = 12.dp),&#10;                        horizontalArrangement = Arrangement.SpaceBetween&#10;                    ) {&#10;                        Text(day)&#10;                        Text(&quot;$value&quot;)&#10;                    }&#10;                    Divider()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;private fun List&lt;Int?&gt;.averageOrNull(): Double? {&#10;    val filtered = this.filterNotNull()&#10;    return if (filtered.isNotEmpty()) filtered.average() else null&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/LoginScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/LoginScreen.kt" />
              <option name="originalContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;&#10;@Composable&#10;fun LoginScreen(&#10;    onLogin: (String, String) -&gt; Unit,&#10;    onNavigateRegister: () -&gt; Unit,&#10;    errorMessage: String?&#10;) {&#10;    val (email, setEmail) = remember { mutableStateOf(&quot;&quot;) }&#10;    val (password, setPassword) = remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(24.dp),&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Text(text = &quot;Masuk ke Healynk&quot;, style = MaterialTheme.typography.headlineMedium)&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        OutlinedTextField(&#10;            value = email,&#10;            onValueChange = setEmail,&#10;            label = { Text(&quot;Email&quot;) },&#10;            modifier = Modifier.fillMaxWidth(),&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Email)&#10;        )&#10;        Spacer(modifier = Modifier.height(12.dp))&#10;        OutlinedTextField(&#10;            value = password,&#10;            onValueChange = setPassword,&#10;            label = { Text(&quot;Password&quot;) },&#10;            modifier = Modifier.fillMaxWidth(),&#10;            visualTransformation = PasswordVisualTransformation(),&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password)&#10;        )&#10;        errorMessage?.let {&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            Text(text = it, color = MaterialTheme.colorScheme.error)&#10;        }&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        Button(onClick = { onLogin(email, password) }, modifier = Modifier.fillMaxWidth()) {&#10;            Text(&quot;Masuk&quot;)&#10;        }&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        TextButton(onClick = onNavigateRegister) {&#10;            Text(&quot;Belum punya akun? Daftar&quot;)&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;&#10;@Composable&#10;fun LoginScreen(&#10;    onLogin: (String, String) -&gt; Unit,&#10;    onNavigateRegister: () -&gt; Unit,&#10;    errorMessage: String?&#10;) {&#10;    val (email, setEmail) = remember { mutableStateOf(&quot;&quot;) }&#10;    val (password, setPassword) = remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(24.dp),&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Text(text = &quot;Masuk ke Healynk&quot;, style = MaterialTheme.typography.headlineMedium)&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        OutlinedTextField(&#10;            value = email,&#10;            onValueChange = setEmail,&#10;            label = { Text(&quot;Email&quot;) },&#10;            modifier = Modifier.fillMaxWidth(),&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Email)&#10;        )&#10;        Spacer(modifier = Modifier.height(12.dp))&#10;        OutlinedTextField(&#10;            value = password,&#10;            onValueChange = setPassword,&#10;            label = { Text(&quot;Password&quot;) },&#10;            modifier = Modifier.fillMaxWidth(),&#10;            visualTransformation = PasswordVisualTransformation(),&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password)&#10;        )&#10;        errorMessage?.let {&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;            Text(text = it, color = MaterialTheme.colorScheme.error)&#10;        }&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        Button(onClick = { onLogin(email, password) }, modifier = Modifier.fillMaxWidth()) {&#10;            Text(&quot;Masuk&quot;)&#10;        }&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        TextButton(onClick = onNavigateRegister) {&#10;            Text(&quot;Belum punya akun? Daftar&quot;)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/RegisterScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/RegisterScreen.kt" />
              <option name="originalContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;&#10;@Composable&#10;fun RegisterScreen(&#10;    onRegister: (String, String) -&gt; Unit,&#10;    onNavigateLogin: () -&gt; Unit,&#10;    errorMessage: String?&#10;) {&#10;    val (email, setEmail) = remember { mutableStateOf(&quot;&quot;) }&#10;    val (password, setPassword) = remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(24.dp),&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Text(text = &quot;Daftar akun Healynk&quot;, style = MaterialTheme.typography.headlineMedium)&#10;        OutlinedTextField(&#10;            value = email,&#10;            onValueChange = setEmail,&#10;            label = { Text(&quot;Email&quot;) },&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Email),&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(top = 16.dp)&#10;        )&#10;        OutlinedTextField(&#10;            value = password,&#10;            onValueChange = setPassword,&#10;            label = { Text(&quot;Password&quot;) },&#10;            visualTransformation = PasswordVisualTransformation(),&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(top = 12.dp)&#10;        )&#10;        errorMessage?.let {&#10;            Text(text = it, color = MaterialTheme.colorScheme.error, modifier = Modifier.padding(top = 8.dp))&#10;        }&#10;        Button(&#10;            onClick = { onRegister(email, password) },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(top = 16.dp)&#10;        ) {&#10;            Text(&quot;Daftar&quot;)&#10;        }&#10;        TextButton(&#10;            onClick = onNavigateLogin,&#10;            modifier = Modifier.align(Alignment.CenterHorizontally)&#10;        ) {&#10;            Text(&quot;Sudah punya akun? Masuk&quot;)&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;&#10;@Composable&#10;fun RegisterScreen(&#10;    onRegister: (String, String) -&gt; Unit,&#10;    onNavigateLogin: () -&gt; Unit,&#10;    errorMessage: String?&#10;) {&#10;    val (email, setEmail) = remember { mutableStateOf(&quot;&quot;) }&#10;    val (password, setPassword) = remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(24.dp),&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Text(text = &quot;Daftar akun Healynk&quot;, style = MaterialTheme.typography.headlineMedium)&#10;        OutlinedTextField(&#10;            value = email,&#10;            onValueChange = setEmail,&#10;            label = { Text(&quot;Email&quot;) },&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Email),&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(top = 16.dp)&#10;        )&#10;        OutlinedTextField(&#10;            value = password,&#10;            onValueChange = setPassword,&#10;            label = { Text(&quot;Password&quot;) },&#10;            visualTransformation = PasswordVisualTransformation(),&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(top = 12.dp)&#10;        )&#10;        errorMessage?.let {&#10;            Text(text = it, color = MaterialTheme.colorScheme.error, modifier = Modifier.padding(top = 8.dp))&#10;        }&#10;        Button(&#10;            onClick = { onRegister(email, password) },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(top = 16.dp)&#10;        ) {&#10;            Text(&quot;Daftar&quot;)&#10;        }&#10;        TextButton(&#10;            onClick = onNavigateLogin,&#10;            modifier = Modifier.align(Alignment.CenterHorizontally)&#10;        ) {&#10;            Text(&quot;Sudah punya akun? Masuk&quot;)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/SettingsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/healynk/ui/screens/SettingsScreen.kt" />
              <option name="originalContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.ColumnScope&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.Divider&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Switch&#10;import androidx.compose.material3.SwitchDefaults&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.healynk.viewmodel.UiState&#10;&#10;@Composable&#10;fun SettingsScreen(&#10;    uiState: UiState,&#10;    onSignOut: () -&gt; Unit,&#10;    onRemovePin: () -&gt; Unit&#10;) {&#10;    var darkModeEnabled by remember { mutableStateOf(false) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&quot;Settings&quot;, style = MaterialTheme.typography.headlineSmall)&#10;        CardSection(title = &quot;Profil&quot;) {&#10;            Text(&quot;Email&quot;, fontWeight = FontWeight.Bold)&#10;            Text(uiState.userEmail.ifBlank { &quot;-&quot; })&#10;        }&#10;        CardSection(title = &quot;Keamanan&quot;) {&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                Column {&#10;                    Text(&quot;PIN lokal&quot;, fontWeight = FontWeight.Bold)&#10;                    Text(if (uiState.hasPin) &quot;PIN aktif&quot; else &quot;Belum ada PIN&quot;)&#10;                }&#10;                TextButton(onClick = onRemovePin, enabled = uiState.hasPin) {&#10;                    Text(&quot;Hapus PIN&quot;)&#10;                }&#10;            }&#10;        }&#10;        CardSection(title = &quot;Tampilan&quot;) {&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                Column {&#10;                    Text(&quot;Mode gelap&quot;, fontWeight = FontWeight.Bold)&#10;                    Text(&quot;Gunakan tema gelap aplikasi&quot;)&#10;                }&#10;                Switch(checked = darkModeEnabled, onCheckedChange = { darkModeEnabled = it }, colors = SwitchDefaults.colors())&#10;            }&#10;        }&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;        Button(onClick = onSignOut, modifier = Modifier.fillMaxWidth()) {&#10;            Text(&quot;Logout&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun CardSection(title: String, content: @Composable ColumnScope.() -&gt; Unit) {&#10;    Card(colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surface)) {&#10;        Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            Text(title, style = MaterialTheme.typography.titleMedium)&#10;            Divider()&#10;            content()&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.healynk.ui.screens&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.ColumnScope&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.Divider&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Switch&#10;import androidx.compose.material3.SwitchDefaults&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.healynk.viewmodel.UiState&#10;&#10;@Composable&#10;fun SettingsScreen(&#10;    uiState: UiState,&#10;    onSignOut: () -&gt; Unit,&#10;    onRemovePin: () -&gt; Unit&#10;) {&#10;    var darkModeEnabled by remember { mutableStateOf(false) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&quot;Settings&quot;, style = MaterialTheme.typography.headlineSmall)&#10;        CardSection(title = &quot;Profil&quot;) {&#10;            Text(&quot;Email&quot;, fontWeight = FontWeight.Bold)&#10;            Text(uiState.userEmail.ifBlank { &quot;-&quot; })&#10;        }&#10;        CardSection(title = &quot;Keamanan&quot;) {&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                Column {&#10;                    Text(&quot;PIN lokal&quot;, fontWeight = FontWeight.Bold)&#10;                    Text(if (uiState.hasPin) &quot;PIN aktif&quot; else &quot;Belum ada PIN&quot;)&#10;                }&#10;                TextButton(onClick = onRemovePin, enabled = uiState.hasPin) {&#10;                    Text(&quot;Hapus PIN&quot;)&#10;                }&#10;            }&#10;        }&#10;        CardSection(title = &quot;Tampilan&quot;) {&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;                Column {&#10;                    Text(&quot;Mode gelap&quot;, fontWeight = FontWeight.Bold)&#10;                    Text(&quot;Gunakan tema gelap aplikasi&quot;)&#10;                }&#10;                Switch(checked = darkModeEnabled, onCheckedChange = { darkModeEnabled = it }, colors = SwitchDefaults.colors())&#10;            }&#10;        }&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;        Button(onClick = onSignOut, modifier = Modifier.fillMaxWidth()) {&#10;            Text(&quot;Logout&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun CardSection(title: String, content: @Composable ColumnScope.() -&gt; Unit) {&#10;    Card(colors = CardDefaults.cardColors(MaterialTheme.colorScheme.surface)) {&#10;        Column(modifier = Modifier.padding(16.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            Text(title, style = MaterialTheme.typography.titleMedium)&#10;            Divider()&#10;            content()&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/healynk/viewmodel/UiViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/healynk/viewmodel/UiViewModel.kt" />
              <option name="originalContent" value="package com.example.healynk.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.ViewModelProvider&#10;import androidx.lifecycle.viewModelScope&#10;import androidx.lifecycle.viewmodel.initializer&#10;import androidx.lifecycle.viewmodel.viewModelFactory&#10;import com.example.healynk.models.ActivityEntry&#10;import com.example.healynk.models.FoodEntry&#10;import com.example.healynk.models.Measurement&#10;import com.example.healynk.services.AuthService&#10;import com.example.healynk.services.FirebaseService&#10;import com.example.healynk.services.PinResult&#10;import com.example.healynk.services.PinService&#10;import com.example.healynk.utils.Constants&#10;import kotlinx.coroutines.Job&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.flow.collectLatest&#10;import kotlinx.coroutines.flow.combine&#10;import kotlinx.coroutines.flow.update&#10;import kotlinx.coroutines.launch&#10;import java.time.Instant&#10;import java.time.LocalDate&#10;import java.time.ZoneId&#10;import java.time.format.DateTimeFormatter&#10;import java.util.Locale&#10;import java.util.UUID&#10;&#10;class UiViewModel(&#10;    private val authService: AuthService,&#10;    private val firebaseService: FirebaseService,&#10;    private val pinService: PinService&#10;) : ViewModel() {&#10;&#10;    private val zoneId: ZoneId = ZoneId.systemDefault()&#10;    private val dayFormatter: DateTimeFormatter = DateTimeFormatter.ofPattern(&quot;dd MMM&quot;, Locale.getDefault())&#10;    private var dataJob: Job? = null&#10;&#10;    private val _uiState = MutableStateFlow(UiState())&#10;    val uiState: StateFlow&lt;UiState&gt; = _uiState.asStateFlow()&#10;&#10;    init {&#10;        observeData()&#10;    }&#10;&#10;    fun initSplash() {&#10;        val userId = authService.currentUserId&#10;        val email = authService.currentUserEmail.orEmpty()&#10;        _uiState.value = _uiState.value.copy(&#10;            isAuthenticated = userId != null,&#10;            hasPin = userId?.let { pinService.hasPin(it) } ?: false,&#10;            userEmail = email&#10;        )&#10;    }&#10;&#10;    fun register(email: String, password: String) = viewModelScope.launch {&#10;        runCatching { authService.register(email, password) }&#10;            .onSuccess {&#10;                _uiState.value = _uiState.value.copy(isAuthenticated = true, error = null)&#10;            }&#10;            .onFailure { _uiState.value = _uiState.value.copy(error = it.message) }&#10;    }&#10;&#10;    fun login(email: String, password: String) = viewModelScope.launch {&#10;        runCatching { authService.login(email, password) }&#10;            .onSuccess {&#10;                _uiState.value = _uiState.value.copy(isAuthenticated = true, error = null)&#10;            }&#10;            .onFailure { _uiState.value = _uiState.value.copy(error = it.message) }&#10;    }&#10;&#10;    fun signOut() {&#10;        authService.logout()&#10;        _uiState.value = UiState()&#10;    }&#10;&#10;    fun refreshPinStatus() {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            _uiState.update { it.copy(hasPin = pinService.hasPin(uid)) }&#10;        }&#10;    }&#10;&#10;    fun removePin() {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            pinService.removePin(uid)&#10;            _uiState.update { it.copy(hasPin = false, pinVerified = false) }&#10;        }&#10;    }&#10;&#10;    fun setPin(pin: String) {&#10;        val userId = authService.currentUserId ?: return&#10;        pinService.savePin(userId, pin)&#10;        _uiState.value = _uiState.value.copy(hasPin = true, pinVerified = true)&#10;    }&#10;&#10;    fun verifyPin(pin: String) {&#10;        val userId = authService.currentUserId ?: return&#10;        when (val result = pinService.verifyPin(userId, pin)) {&#10;            PinResult.Success -&gt; _uiState.value = _uiState.value.copy(pinVerified = true, error = null)&#10;            is PinResult.Failure -&gt; _uiState.value = _uiState.value.copy(error = &quot;PIN salah, sisa ${result.attemptsRemaining}&quot;)&#10;            is PinResult.Locked -&gt; _uiState.value = _uiState.value.copy(error = &quot;Terkunci hingga ${result.unlockTimeMillis}&quot;)&#10;            PinResult.NoPin -&gt; _uiState.value = _uiState.value.copy(hasPin = false)&#10;        }&#10;    }&#10;&#10;    fun addMeasurement(measurement: Measurement) = viewModelScope.launch {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            val payload = (if (measurement.id.isBlank()) {&#10;                measurement.copy(id = UUID.randomUUID().toString())&#10;            } else measurement).copy(userId = uid)&#10;            firebaseService.addMeasurement(uid, payload)&#10;        }&#10;    }&#10;&#10;    fun addActivity(activity: ActivityEntry) = viewModelScope.launch {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            val payload = (if (activity.id.isBlank()) {&#10;                activity.copy(id = UUID.randomUUID().toString())&#10;            } else activity).copy(userId = uid)&#10;            firebaseService.addActivity(uid, payload)&#10;        }&#10;    }&#10;&#10;    fun addFood(foodEntry: FoodEntry) = viewModelScope.launch {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            val payload = (if (foodEntry.id.isBlank()) {&#10;                foodEntry.copy(id = UUID.randomUUID().toString())&#10;            } else foodEntry).copy(userId = uid)&#10;            firebaseService.addFood(uid, payload)&#10;        }&#10;    }&#10;&#10;    fun deleteMeasurement(id: String) = viewModelScope.launch {&#10;        authService.currentUserId?.let { firebaseService.deleteMeasurement(it, id) }&#10;    }&#10;&#10;    fun deleteActivity(id: String) = viewModelScope.launch {&#10;        authService.currentUserId?.let { firebaseService.deleteActivity(it, id) }&#10;    }&#10;&#10;    fun deleteFood(id: String) = viewModelScope.launch {&#10;        authService.currentUserId?.let { firebaseService.deleteFood(it, id) }&#10;    }&#10;&#10;    private fun observeData() {&#10;        dataJob?.cancel()&#10;        dataJob = viewModelScope.launch {&#10;            authService.authState().collectLatest { isLoggedIn -&gt;&#10;                if (!isLoggedIn) {&#10;                    _uiState.value = UiState()&#10;                    return@collectLatest&#10;                }&#10;                val userId = authService.currentUserId ?: return@collectLatest&#10;                combine(&#10;                    firebaseService.measurementsFlow(userId),&#10;                    firebaseService.activitiesFlow(userId),&#10;                    firebaseService.foodsFlow(userId)&#10;                ) { measurements, activities, foods -&gt;&#10;                    val todayFoods = foods.filter { it.isToday() }&#10;                    val todayActivities = activities.filter { it.isToday() }&#10;                    val groupedMeasurements = measurements.groupByDay()&#10;                    val groupedFoods = foods.groupFoodDayCalories()&#10;                    val groupedActivities = activities.groupActivityDayCalories()&#10;                    UiState(&#10;                        isAuthenticated = true,&#10;                        hasPin = pinService.hasPin(userId),&#10;                        pinVerified = _uiState.value.pinVerified,&#10;                        measurements = measurements,&#10;                        activities = activities,&#10;                        foods = foods,&#10;                        dailyCalories = todayFoods.sumOf { it.calories },&#10;                        dailyActivityCalories = todayActivities.sumOf { it.caloriesBurned ?: 0 },&#10;                        dailyCaloriesGoal = Constants.DAILY_CALORIE_GOAL,&#10;                        latestMeasurement = measurements.maxByOrNull { it.timestamp },&#10;                        weightTrend = groupedMeasurements.weightTrend(),&#10;                        bloodPressureTrend = groupedMeasurements.bloodPressureTrend(),&#10;                        glucoseTrend = groupedMeasurements.glucoseTrend(),&#10;                        weeklyFoodChart = groupedFoods,&#10;                        weeklyActivityChart = groupedActivities,&#10;                        summarySteps = todayActivities.sumOf { it.steps ?: 0 },&#10;                        summaryDuration = todayActivities.sumOf { it.durationMinutes ?: 0 },&#10;                        error = null,&#10;                        userEmail = authService.currentUserEmail.orEmpty()&#10;                    )&#10;                }.collectLatest { newState -&gt;&#10;                    _uiState.value = newState&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun Measurement.isToday(): Boolean = timestamp &gt;= startOfDay() &amp;&amp; timestamp &lt;= endOfDay()&#10;    private fun ActivityEntry.isToday(): Boolean = timestamp &gt;= startOfDay() &amp;&amp; timestamp &lt;= endOfDay()&#10;    private fun FoodEntry.isToday(): Boolean = timestamp &gt;= startOfDay() &amp;&amp; timestamp &lt;= endOfDay()&#10;&#10;    private fun startOfDay(): Long {&#10;        val now = System.currentTimeMillis()&#10;        return now - (now % (24 * 60 * 60 * 1000))&#10;    }&#10;&#10;    private fun endOfDay(): Long = startOfDay() + (24 * 60 * 60 * 1000)&#10;&#10;    private fun List&lt;Measurement&gt;.groupByDay(): Map&lt;String, List&lt;Measurement&gt;&gt; =&#10;        groupBy { measurement -&gt;&#10;            Instant.ofEpochMilli(measurement.timestamp).atZone(zoneId).toLocalDate().format(dayFormatter)&#10;        }&#10;&#10;    private fun Map&lt;String, List&lt;Measurement&gt;&gt;.weightTrend(): List&lt;Pair&lt;String, Double&gt;&gt; =&#10;        entries.map { (day, entries) -&gt;&#10;            day to (entries.lastOrNull { it.weightKg != null }?.weightKg ?: 0.0)&#10;        }.takeLast(7)&#10;&#10;    private fun Map&lt;String, List&lt;Measurement&gt;&gt;.bloodPressureTrend(): List&lt;Pair&lt;String, Pair&lt;Int?, Int?&gt;&gt;&gt; =&#10;        entries.map { (day, entries) -&gt;&#10;            day to (entries.lastOrNull()?.let { it.systolic to it.diastolic } ?: (null to null))&#10;        }.takeLast(7)&#10;&#10;    private fun Map&lt;String, List&lt;Measurement&gt;&gt;.glucoseTrend(): List&lt;Pair&lt;String, Int?&gt;&gt; =&#10;        entries.map { (day, entries) -&gt;&#10;            day to entries.lastOrNull { it.glucoseMgDl != null }?.glucoseMgDl&#10;        }.takeLast(7)&#10;&#10;    private fun List&lt;FoodEntry&gt;.groupFoodDayCalories(): List&lt;Pair&lt;String, Int&gt;&gt; =&#10;        groupBy { Instant.ofEpochMilli(it.timestamp).atZone(zoneId).toLocalDate().format(dayFormatter) }&#10;            .map { (day, entries) -&gt; day to entries.sumOf { entry -&gt; entry.calories } }&#10;            .sortedBy { LocalDate.parse(it.first, dayFormatter) }&#10;            .takeLast(7)&#10;&#10;    private fun List&lt;ActivityEntry&gt;.groupActivityDayCalories(): List&lt;Pair&lt;String, Int&gt;&gt; =&#10;        groupBy { Instant.ofEpochMilli(it.timestamp).atZone(zoneId).toLocalDate().format(dayFormatter) }&#10;            .map { (day, entries) -&gt; day to entries.sumOf { entry -&gt; entry.caloriesBurned ?: 0 } }&#10;            .sortedBy { LocalDate.parse(it.first, dayFormatter) }&#10;            .takeLast(7)&#10;&#10;    companion object {&#10;        fun factory(&#10;            authService: AuthService,&#10;            firebaseService: FirebaseService,&#10;            pinService: PinService&#10;        ): ViewModelProvider.Factory = viewModelFactory {&#10;            initializer {&#10;                UiViewModel(authService, firebaseService, pinService)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;data class UiState(&#10;    val isAuthenticated: Boolean = false,&#10;    val hasPin: Boolean = false,&#10;    val pinVerified: Boolean = false,&#10;    val measurements: List&lt;Measurement&gt; = emptyList(),&#10;    val activities: List&lt;ActivityEntry&gt; = emptyList(),&#10;    val foods: List&lt;FoodEntry&gt; = emptyList(),&#10;    val dailyCalories: Int = 0,&#10;    val dailyActivityCalories: Int = 0,&#10;    val dailyCaloriesGoal: Int = Constants.DAILY_CALORIE_GOAL,&#10;    val latestMeasurement: Measurement? = null,&#10;    val weightTrend: List&lt;Pair&lt;String, Double&gt;&gt; = emptyList(),&#10;    val bloodPressureTrend: List&lt;Pair&lt;String, Pair&lt;Int?, Int?&gt;&gt;&gt; = emptyList(),&#10;    val glucoseTrend: List&lt;Pair&lt;String, Int?&gt;&gt; = emptyList(),&#10;    val weeklyFoodChart: List&lt;Pair&lt;String, Int&gt;&gt; = emptyList(),&#10;    val weeklyActivityChart: List&lt;Pair&lt;String, Int&gt;&gt; = emptyList(),&#10;    val summarySteps: Int = 0,&#10;    val summaryDuration: Int = 0,&#10;    val error: String? = null,&#10;    val userEmail: String = &quot;&quot;&#10;)&#10;" />
              <option name="updatedContent" value="package com.example.healynk.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.ViewModelProvider&#10;import androidx.lifecycle.viewModelScope&#10;import androidx.lifecycle.viewmodel.initializer&#10;import androidx.lifecycle.viewmodel.viewModelFactory&#10;import com.example.healynk.models.ActivityEntry&#10;import com.example.healynk.models.FoodEntry&#10;import com.example.healynk.models.Measurement&#10;import com.example.healynk.services.AuthService&#10;import com.example.healynk.services.FirebaseService&#10;import com.example.healynk.services.PinResult&#10;import com.example.healynk.services.PinService&#10;import com.example.healynk.utils.Constants&#10;import kotlinx.coroutines.Job&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.flow.collectLatest&#10;import kotlinx.coroutines.flow.combine&#10;import kotlinx.coroutines.flow.update&#10;import kotlinx.coroutines.launch&#10;import java.time.Instant&#10;import java.time.LocalDate&#10;import java.time.ZoneId&#10;import java.time.format.DateTimeFormatter&#10;import java.util.Locale&#10;import java.util.UUID&#10;&#10;class UiViewModel(&#10;    private val authService: AuthService,&#10;    private val firebaseService: FirebaseService,&#10;    private val pinService: PinService&#10;) : ViewModel() {&#10;&#10;    private val zoneId: ZoneId = ZoneId.systemDefault()&#10;    private val dayFormatter: DateTimeFormatter = DateTimeFormatter.ofPattern(&quot;dd MMM&quot;, Locale.getDefault())&#10;    private var dataJob: Job? = null&#10;&#10;    private val _uiState = MutableStateFlow(UiState())&#10;    val uiState: StateFlow&lt;UiState&gt; = _uiState.asStateFlow()&#10;&#10;    init {&#10;        observeData()&#10;    }&#10;&#10;    fun initSplash() {&#10;        val userId = authService.currentUserId&#10;        val email = authService.currentUserEmail.orEmpty()&#10;        _uiState.value = _uiState.value.copy(&#10;            isAuthenticated = userId != null,&#10;            hasPin = userId?.let { pinService.hasPin(it) } ?: false,&#10;            userEmail = email&#10;        )&#10;    }&#10;&#10;    fun register(email: String, password: String) = viewModelScope.launch {&#10;        runCatching { authService.register(email, password) }&#10;            .onSuccess {&#10;                _uiState.value = _uiState.value.copy(isAuthenticated = true, error = null)&#10;            }&#10;            .onFailure { _uiState.value = _uiState.value.copy(error = it.message) }&#10;    }&#10;&#10;    fun login(email: String, password: String) = viewModelScope.launch {&#10;        runCatching { authService.login(email, password) }&#10;            .onSuccess {&#10;                _uiState.value = _uiState.value.copy(isAuthenticated = true, error = null)&#10;            }&#10;            .onFailure { _uiState.value = _uiState.value.copy(error = it.message) }&#10;    }&#10;&#10;    fun signOut() {&#10;        authService.logout()&#10;        _uiState.value = UiState()&#10;    }&#10;&#10;    fun refreshPinStatus() {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            _uiState.update { it.copy(hasPin = pinService.hasPin(uid)) }&#10;        }&#10;    }&#10;&#10;    fun removePin() {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            pinService.removePin(uid)&#10;            _uiState.update { it.copy(hasPin = false, pinVerified = false) }&#10;        }&#10;    }&#10;&#10;    fun setPin(pin: String) {&#10;        val userId = authService.currentUserId ?: return&#10;        pinService.savePin(userId, pin)&#10;        _uiState.value = _uiState.value.copy(hasPin = true, pinVerified = true)&#10;    }&#10;&#10;    fun verifyPin(pin: String) {&#10;        val userId = authService.currentUserId ?: return&#10;        when (val result = pinService.verifyPin(userId, pin)) {&#10;            PinResult.Success -&gt; _uiState.value = _uiState.value.copy(pinVerified = true, error = null)&#10;            is PinResult.Failure -&gt; _uiState.value = _uiState.value.copy(error = &quot;PIN salah, sisa ${result.attemptsRemaining}&quot;)&#10;            is PinResult.Locked -&gt; _uiState.value = _uiState.value.copy(error = &quot;Terkunci hingga ${result.unlockTimeMillis}&quot;)&#10;            PinResult.NoPin -&gt; _uiState.value = _uiState.value.copy(hasPin = false)&#10;        }&#10;    }&#10;&#10;    fun addMeasurement(measurement: Measurement) = viewModelScope.launch {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            val payload = (if (measurement.id.isBlank()) {&#10;                measurement.copy(id = UUID.randomUUID().toString())&#10;            } else measurement).copy(userId = uid)&#10;            firebaseService.addMeasurement(uid, payload)&#10;        }&#10;    }&#10;&#10;    fun addActivity(activity: ActivityEntry) = viewModelScope.launch {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            val payload = (if (activity.id.isBlank()) {&#10;                activity.copy(id = UUID.randomUUID().toString())&#10;            } else activity).copy(userId = uid)&#10;            firebaseService.addActivity(uid, payload)&#10;        }&#10;    }&#10;&#10;    fun addFood(foodEntry: FoodEntry) = viewModelScope.launch {&#10;        authService.currentUserId?.let { uid -&gt;&#10;            val payload = (if (foodEntry.id.isBlank()) {&#10;                foodEntry.copy(id = UUID.randomUUID().toString())&#10;            } else foodEntry).copy(userId = uid)&#10;            firebaseService.addFood(uid, payload)&#10;        }&#10;    }&#10;&#10;    fun deleteMeasurement(id: String) = viewModelScope.launch {&#10;        authService.currentUserId?.let { firebaseService.deleteMeasurement(it, id) }&#10;    }&#10;&#10;    fun deleteActivity(id: String) = viewModelScope.launch {&#10;        authService.currentUserId?.let { firebaseService.deleteActivity(it, id) }&#10;    }&#10;&#10;    fun deleteFood(id: String) = viewModelScope.launch {&#10;        authService.currentUserId?.let { firebaseService.deleteFood(it, id) }&#10;    }&#10;&#10;    private fun observeData() {&#10;        dataJob?.cancel()&#10;        dataJob = viewModelScope.launch {&#10;            authService.authState().collectLatest { isLoggedIn -&gt;&#10;                if (!isLoggedIn) {&#10;                    _uiState.value = UiState()&#10;                    return@collectLatest&#10;                }&#10;                val userId = authService.currentUserId ?: return@collectLatest&#10;                combine(&#10;                    firebaseService.measurementsFlow(userId),&#10;                    firebaseService.activitiesFlow(userId),&#10;                    firebaseService.foodsFlow(userId)&#10;                ) { measurements, activities, foods -&gt;&#10;                    val todayFoods = foods.filter { it.isToday() }&#10;                    val todayActivities = activities.filter { it.isToday() }&#10;                    val groupedMeasurements = measurements.groupByDay()&#10;                    val groupedFoods = foods.groupFoodDayCalories()&#10;                    val groupedActivities = activities.groupActivityDayCalories()&#10;                    UiState(&#10;                        isAuthenticated = true,&#10;                        hasPin = pinService.hasPin(userId),&#10;                        pinVerified = _uiState.value.pinVerified,&#10;                        measurements = measurements,&#10;                        activities = activities,&#10;                        foods = foods,&#10;                        dailyCalories = todayFoods.sumOf { it.calories },&#10;                        dailyActivityCalories = todayActivities.sumOf { it.caloriesBurned ?: 0 },&#10;                        dailyCaloriesGoal = Constants.DAILY_CALORIE_GOAL,&#10;                        latestMeasurement = measurements.maxByOrNull { it.timestamp },&#10;                        weightTrend = groupedMeasurements.weightTrend(),&#10;                        bloodPressureTrend = groupedMeasurements.bloodPressureTrend(),&#10;                        glucoseTrend = groupedMeasurements.glucoseTrend(),&#10;                        weeklyFoodChart = groupedFoods,&#10;                        weeklyActivityChart = groupedActivities,&#10;                        summarySteps = todayActivities.sumOf { it.steps ?: 0 },&#10;                        summaryDuration = todayActivities.sumOf { it.durationMinutes ?: 0 },&#10;                        error = null,&#10;                        userEmail = authService.currentUserEmail.orEmpty()&#10;                    )&#10;                }.collectLatest { newState -&gt;&#10;                    _uiState.value = newState&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun Measurement.isToday(): Boolean = timestamp &gt;= startOfDay() &amp;&amp; timestamp &lt;= endOfDay()&#10;    private fun ActivityEntry.isToday(): Boolean = timestamp &gt;= startOfDay() &amp;&amp; timestamp &lt;= endOfDay()&#10;    private fun FoodEntry.isToday(): Boolean = timestamp &gt;= startOfDay() &amp;&amp; timestamp &lt;= endOfDay()&#10;&#10;    private fun startOfDay(): Long {&#10;        val now = System.currentTimeMillis()&#10;        return now - (now % (24 * 60 * 60 * 1000))&#10;    }&#10;&#10;    private fun endOfDay(): Long = startOfDay() + (24 * 60 * 60 * 1000)&#10;&#10;    private fun List&lt;Measurement&gt;.groupByDay(): Map&lt;String, List&lt;Measurement&gt;&gt; =&#10;        groupBy { measurement -&gt;&#10;            Instant.ofEpochMilli(measurement.timestamp).atZone(zoneId).toLocalDate().format(dayFormatter)&#10;        }&#10;&#10;    private fun Map&lt;String, List&lt;Measurement&gt;&gt;.weightTrend(): List&lt;Pair&lt;String, Double&gt;&gt; =&#10;        entries.map { (day, entries) -&gt;&#10;            day to (entries.lastOrNull { it.weightKg != null }?.weightKg ?: 0.0)&#10;        }.takeLast(7)&#10;&#10;    private fun Map&lt;String, List&lt;Measurement&gt;&gt;.bloodPressureTrend(): List&lt;Pair&lt;String, Pair&lt;Int?, Int?&gt;&gt;&gt; =&#10;        entries.map { (day, entries) -&gt;&#10;            day to (entries.lastOrNull()?.let { it.systolic to it.diastolic } ?: (null to null))&#10;        }.takeLast(7)&#10;&#10;    private fun Map&lt;String, List&lt;Measurement&gt;&gt;.glucoseTrend(): List&lt;Pair&lt;String, Int?&gt;&gt; =&#10;        entries.map { (day, entries) -&gt;&#10;            day to entries.lastOrNull { it.glucoseMgDl != null }?.glucoseMgDl&#10;        }.takeLast(7)&#10;&#10;    private fun List&lt;FoodEntry&gt;.groupFoodDayCalories(): List&lt;Pair&lt;String, Int&gt;&gt; =&#10;        groupBy { Instant.ofEpochMilli(it.timestamp).atZone(zoneId).toLocalDate().format(dayFormatter) }&#10;            .map { (day, entries) -&gt; day to entries.sumOf { entry -&gt; entry.calories } }&#10;            .sortedBy { LocalDate.parse(it.first, dayFormatter) }&#10;            .takeLast(7)&#10;&#10;    private fun List&lt;ActivityEntry&gt;.groupActivityDayCalories(): List&lt;Pair&lt;String, Int&gt;&gt; =&#10;        groupBy { Instant.ofEpochMilli(it.timestamp).atZone(zoneId).toLocalDate().format(dayFormatter) }&#10;            .map { (day, entries) -&gt; day to entries.sumOf { entry -&gt; entry.caloriesBurned ?: 0 } }&#10;            .sortedBy { LocalDate.parse(it.first, dayFormatter) }&#10;            .takeLast(7)&#10;&#10;    companion object {&#10;        fun factory(&#10;            authService: AuthService,&#10;            firebaseService: FirebaseService,&#10;            pinService: PinService&#10;        ): ViewModelProvider.Factory = viewModelFactory {&#10;            initializer {&#10;                UiViewModel(authService, firebaseService, pinService)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;data class UiState(&#10;    val isAuthenticated: Boolean = false,&#10;    val hasPin: Boolean = false,&#10;    val pinVerified: Boolean = false,&#10;    val measurements: List&lt;Measurement&gt; = emptyList(),&#10;    val activities: List&lt;ActivityEntry&gt; = emptyList(),&#10;    val foods: List&lt;FoodEntry&gt; = emptyList(),&#10;    val dailyCalories: Int = 0,&#10;    val dailyActivityCalories: Int = 0,&#10;    val dailyCaloriesGoal: Int = Constants.DAILY_CALORIE_GOAL,&#10;    val latestMeasurement: Measurement? = null,&#10;    val weightTrend: List&lt;Pair&lt;String, Double&gt;&gt; = emptyList(),&#10;    val bloodPressureTrend: List&lt;Pair&lt;String, Pair&lt;Int?, Int?&gt;&gt;&gt; = emptyList(),&#10;    val glucoseTrend: List&lt;Pair&lt;String, Int?&gt;&gt; = emptyList(),&#10;    val weeklyFoodChart: List&lt;Pair&lt;String, Int&gt;&gt; = emptyList(),&#10;    val weeklyActivityChart: List&lt;Pair&lt;String, Int&gt;&gt; = emptyList(),&#10;    val summarySteps: Int = 0,&#10;    val summaryDuration: Int = 0,&#10;    val error: String? = null,&#10;    val userEmail: String = &quot;&quot;&#10;)" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>